# Story 2.2: Cadastro de Fornecedores Progressivo

## Status: Draft

## Story

**As a** usuario,
**I want** cadastrar fornecedores de forma rapida,
**so that** eu possa registrar minhas compras e contas a pagar associadas.

## Acceptance Criteria

1. Model Fornecedor no Prisma: id, tenantId, name (obrigatorio), phone, email, document (CNPJ/CPF), address (JSON), notes, createdAt, updatedAt
2. Formulario progressivo identico ao de Clientes (nome obrigatorio, demais expandiveis)
3. Lista com busca por nome/telefone/documento
4. Tela de detalhe do fornecedor
5. Edicao inline dos campos
6. RLS aplicado - fornecedores isolados por tenant

## Tasks / Subtasks

- [ ] Adicionar model Fornecedor ao Prisma schema (AC: 1, 6)
  - [ ] Adicionar model `Fornecedor` em `prisma/schema.prisma` com campos: id (cuid), tenantId (String, FK para Tenant), name (String), phone (String?), email (String?), document (String?), address (Json?), notes (String?), createdAt, updatedAt
  - [ ] Adicionar relation `fornecedores Fornecedor[]` no model Tenant
  - [ ] Criar indice `@@index([tenantId, name])`
  - [ ] `@@map("fornecedores")`
  - [ ] Executar `npx prisma generate`
- [ ] Criar service de fornecedores (AC: 1, 3, 6)
  - [ ] Criar `src/modules/cadastros/fornecedor.service.ts`
  - [ ] Funcao `createFornecedor(data)`: cria fornecedor usando `prisma` (com tenant auto-inject)
  - [ ] Funcao `listFornecedores({ search?, page?, pageSize? })`: lista com busca e paginacao
  - [ ] Funcao `getFornecedor(id)`: busca por id
  - [ ] Funcao `updateFornecedor(id, data)`: atualiza campos
  - [ ] Funcao `deleteFornecedor(id)`: deleta fornecedor
  - [ ] Reutilizar mesmo padrao do `cliente.service.ts`
- [ ] Criar Zod schemas de validacao (AC: 1)
  - [ ] Criar `src/modules/cadastros/fornecedor.schema.ts`
  - [ ] `createFornecedorSchema`: name (min 2, obrigatorio), phone/email/document/address/notes todos opcionais
  - [ ] `updateFornecedorSchema`: todos campos optional (partial)
  - [ ] `listFornecedorQuerySchema`: search, page, pageSize
  - [ ] Validacao de document (CPF/CNPJ) quando preenchido via `isValidDocument`
- [ ] Criar API routes REST (AC: 1, 3, 6)
  - [ ] Criar `src/app/api/v1/fornecedores/route.ts` com GET (listar) e POST (criar)
  - [ ] Criar `src/app/api/v1/fornecedores/[id]/route.ts` com GET, PATCH, DELETE
  - [ ] Todos endpoints usam `withTenantApi`
- [ ] Criar pagina de lista de fornecedores (AC: 2, 3)
  - [ ] Criar `src/app/(dashboard)/cadastros/fornecedores/page.tsx` como Client Component
  - [ ] Header com titulo "Fornecedores" e botao "+ Novo Fornecedor"
  - [ ] Campo de busca com debounce (300ms)
  - [ ] Lista em cards com nome, telefone, email
  - [ ] Paginacao com contagem total
  - [ ] Empty state com CTA "Cadastre seu primeiro fornecedor"
  - [ ] Loading skeleton
- [ ] Criar formulario progressivo de novo fornecedor (AC: 2, 5)
  - [ ] Criar `src/app/(dashboard)/cadastros/fornecedores/novo/page.tsx` como Client Component
  - [ ] Campo inicial visivel: nome (obrigatorio)
  - [ ] Botao "Mais detalhes" expande: telefone, email, CPF/CNPJ (com validacao), endereco, observacoes
  - [ ] Botoes "Salvar" e "Cancelar"
  - [ ] Redirect para lista apos salvar com toast
- [ ] Criar tela de detalhe do fornecedor (AC: 4, 5)
  - [ ] Criar `src/app/(dashboard)/cadastros/fornecedores/[id]/page.tsx` como Client Component
  - [ ] Exibir todos os campos
  - [ ] Edicao inline: clicar no campo abre input
  - [ ] Secao placeholder "Historico de Compras"
  - [ ] Botao "Excluir fornecedor" com dialog de confirmacao

## Dev Notes

**Source Tree relevante:**
```
src/
├── app/(dashboard)/cadastros/fornecedores/
│   ├── page.tsx                # Lista de fornecedores
│   ├── novo/page.tsx           # Formulario novo fornecedor
│   └── [id]/page.tsx           # Detalhe do fornecedor
├── app/api/v1/fornecedores/
│   ├── route.ts                # GET + POST
│   └── [id]/route.ts           # GET + PATCH + DELETE
└── modules/cadastros/
    ├── fornecedor.service.ts   # Business logic
    └── fornecedor.schema.ts    # Zod schemas
```

**Depende de:** Story 2.1 (padrao de CRUD de cadastros, validateCPF, isValidDocument ja implementados)

**Reutilizacao do Story 2.1:** O padrao de service, schema, API route e UI e identico ao de Clientes. A diferenca principal e que Fornecedor nao tem phone como obrigatorio (apenas name e obrigatorio).

**Padrao de API:** Mesmo `withTenantApi` wrapper do Story 2.1.

**Componentes shadcn/ui:** Mesmos do Story 2.1 (Button, Input, Card, Dialog, Skeleton, Sonner).

**Coding Standards:**
- Services em kebab-case: `fornecedor.service.ts`
- API routes: `/api/v1/fornecedores`
- Schemas: `createFornecedorSchema`

### Testing

- **Localizacao:** `tests/unit/modules/cadastros/`
- **Framework:** Vitest
- **Testes necessarios:**
  - `createFornecedorSchema` valida input correto e rejeita invalido
  - Service `createFornecedor` chama prisma.fornecedor.create
  - Service `listFornecedores` com paginacao e busca
  - Service `getFornecedor` retorna fornecedor por id
  - Service `updateFornecedor` atualiza campos
- **Mocks:** Mock do `prisma` para testes de service

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-07 | 1.0 | Criacao inicial da story | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*A ser preenchido pelo dev agent*

### Debug Log References
*A ser preenchido pelo dev agent*

### Completion Notes List
*A ser preenchido pelo dev agent*

### File List
*A ser preenchido pelo dev agent*

## QA Results
*A ser preenchido pelo QA agent*
