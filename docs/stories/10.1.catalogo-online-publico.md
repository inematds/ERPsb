# Story 10.1: Catalogo Online Publico

## Status: Draft

## Story

**As a** usuario,
**I want** ter uma pagina publica com meus produtos que eu possa compartilhar pelo WhatsApp,
**so that** meus clientes vejam o que vendo sem eu precisar mandar foto por foto.

## Acceptance Criteria

1. Pagina publica (sem login) em `/loja/{slug}` com produtos do tenant
2. Slug personalizavel pelo dono (ex: "maria-confeccoes"), unico globalmente
3. Header da loja: logo, nome, telefone WhatsApp (clicavel)
4. Grid de produtos com foto, nome e preco
5. Filtro por categoria e busca por nome
6. Pagina de detalhe do produto: fotos (carousel), descricao, preco, botao "Comprar pelo WhatsApp"
7. Botao "Comprar pelo WhatsApp" abre `wa.me/{numero}?text=Ola! Tenho interesse no {produto} (R$ {preco})`
8. Apenas produtos com `showOnline = true` aparecem no catalogo
9. SEO: meta tags, Open Graph (preview bonito ao compartilhar no WhatsApp/Instagram)
10. QR code gerado automaticamente com link da loja (para impressao)
11. Tela de configuracao da loja no dashboard: nome, slug, logo, WhatsApp, ativar/desativar
12. Responsivo: mobile-first, grid adaptavel (1 coluna mobile, 2 tablet, 3 desktop)
13. Modo "loja desativada": se storeActive=false, mostra pagina bonita de "em breve"

## Tasks / Subtasks

- [ ] Adicionar campos de loja no Tenant (AC: 2, 11)
  - [ ] storeSlug (String?, @unique), storeName, storeLogo, storeWhatsApp, storeBanner, storeActive
  - [ ] Prisma generate
- [ ] Adicionar campos de catalogo no Produto (AC: 4, 8)
  - [ ] images (String[]), showOnline (Boolean, default true), category (String?)
  - [ ] Prisma generate
- [ ] Criar pagina publica do catalogo (AC: 1, 3, 4, 5, 8, 12, 13)
  - [ ] Criar `src/app/loja/[slug]/page.tsx` como Server Component (fora do dashboard layout)
  - [ ] Buscar tenant por slug
  - [ ] Se storeActive=false: pagina "em breve"
  - [ ] Header com logo, nome, WhatsApp
  - [ ] Grid de produtos (showOnline=true)
  - [ ] Filtro por category (client-side)
  - [ ] Busca por nome (client-side)
  - [ ] Paginacao ou infinite scroll
- [ ] Criar pagina de detalhe do produto publica (AC: 6, 7)
  - [ ] Criar `src/app/loja/[slug]/[productId]/page.tsx`
  - [ ] Carousel de fotos (ou foto unica)
  - [ ] Nome, descricao, preco
  - [ ] Botao "Comprar pelo WhatsApp" com link wa.me pre-formatado
  - [ ] Botao "Adicionar ao carrinho" (placeholder para Story 10.2)
- [ ] SEO e Open Graph (AC: 9)
  - [ ] generateMetadata() com titulo, descricao, og:image (logo ou primeiro produto)
  - [ ] Structured data (JSON-LD) para loja e produtos
- [ ] Gerador de QR code (AC: 10)
  - [ ] Usar lib qrcode (lightweight) para gerar QR com URL da loja
  - [ ] Botao "Baixar QR Code" na tela de config
- [ ] Tela de configuracao da loja (AC: 11)
  - [ ] Criar `src/app/(dashboard)/configuracoes/loja/page.tsx` como Client Component
  - [ ] Formulario: nome, slug (verifica disponibilidade), WhatsApp, logo (upload), banner (upload)
  - [ ] Toggle ativar/desativar
  - [ ] Preview do link + botao copiar + QR code
  - [ ] Gerenciar quais produtos aparecem online (toggle por produto)
- [ ] API endpoints (AC: 1, 11)
  - [ ] `src/app/api/v1/loja/config/route.ts` GET + PUT (config da loja)
  - [ ] `src/app/api/v1/loja/check-slug/route.ts` GET (verificar disponibilidade)
  - [ ] `src/app/api/public/loja/[slug]/route.ts` GET (dados publicos, sem auth)
  - [ ] `src/app/api/public/loja/[slug]/produtos/route.ts` GET (produtos publicos)

## Dev Notes

**Source Tree relevante:**
```
src/
├── app/
│   ├── loja/                          # Paginas publicas (fora do dashboard)
│   │   └── [slug]/
│   │       ├── page.tsx               # Catalogo
│   │       ├── [productId]/page.tsx   # Detalhe produto
│   │       └── layout.tsx             # Layout publico (sem sidebar)
│   └── (dashboard)/configuracoes/loja/
│       └── page.tsx                   # Config da loja
├── app/api/
│   ├── v1/loja/                       # APIs autenticadas
│   └── public/loja/                   # APIs publicas
```

**CRITICO - Performance:**
- Pagina publica deve ser rapida (SEO + UX)
- Usar ISR (Incremental Static Regeneration) com revalidate de 60s
- Ou generateStaticParams para slugs mais acessados
- Imagens: usar next/image com Supabase Storage

**CRITICO - Seguranca:**
- Paginas publicas NAO passam pelo middleware de auth
- APIs publicas NAO exigem autenticacao
- Nunca expor dados sensiveis (precos de custo, margens, dados financeiros)
- Rate limit nas APIs publicas (evitar scraping)

**Upload de imagens:**
- Reutilizar Supabase Storage (da Story 7.1 se implementada, ou criar novo)
- Bucket publico para imagens da loja (produtos, logo, banner)
- Resize automatico: thumbnail (200x200), medium (600x600), large (1200x1200)
- Aceitar: jpg, png, webp. Max 5MB por imagem.

**WhatsApp link format:**
```
https://wa.me/5511999887766?text=Ol%C3%A1!%20Tenho%20interesse%20no%20Camiseta%20P%20(R%24%2049%2C90)%20-%20vi%20no%20cat%C3%A1logo%20online
```

### Testing

- **Testes necessarios:**
  - Pagina publica: renderiza produtos do tenant
  - Pagina publica: nao mostra produtos com showOnline=false
  - Pagina publica: mostra "em breve" se storeActive=false
  - API check-slug: retorna disponibilidade
  - Config: salva e atualiza dados da loja
  - QR code: gera imagem com URL correta

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-09 | 1.0 | Criacao inicial da story | Sarah (PO) |

## Dev Agent Record
*A ser preenchido durante implementacao*

## QA Results
*A ser preenchido pelo QA agent*
