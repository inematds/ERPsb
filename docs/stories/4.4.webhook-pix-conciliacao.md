# Story 4.4: Webhook PIX e Conciliacao Automatica

## Status: Draft

## Story

**As a** usuario,
**I want** que o sistema detecte automaticamente quando um PIX for pago,
**so that** eu nao precise baixar manualmente cada recebimento.

## Acceptance Criteria

1. Endpoint webhook para receber notificacoes do Mercado Pago
2. Webhook valida assinatura do Mercado Pago
3. Ao receber pagamento: atualiza PixCharge e ContaReceber automaticamente
4. Notificacao para o usuario
5. Tratamento de falhas com retry
6. Log de notificacoes para auditoria
7. Endpoint de consulta manual de status (fallback)

## Tasks / Subtasks

- [ ] Criar webhook endpoint (AC: 1, 2)
- [ ] Criar handler de pagamento (AC: 3)
- [ ] Criar sistema de notificacao (AC: 4)
- [ ] Criar retry/fallback (AC: 5, 7)
- [ ] Criar logs de auditoria (AC: 6)

## Dev Notes

**Depende de:** Story 4.3 (PixCharge model + Mercado Pago client)
**Requer:** BullMQ para retry, Upstash Redis

### Testing

- **Testes:** Webhook validation, payment processing, retry logic

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-07 | 1.0 | Criacao inicial da story | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*A ser preenchido*

### Debug Log References
*A ser preenchido*

### Completion Notes List
*A ser preenchido*

### File List
*A ser preenchido*

## QA Results
*A ser preenchido pelo QA agent*
