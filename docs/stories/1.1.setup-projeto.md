# Story 1.1: Setup do Projeto e Infraestrutura Base

## Status: Draft

## Story

**As a** desenvolvedor,
**I want** ter o projeto Next.js 15 configurado com TypeScript, Tailwind, shadcn/ui, PostgreSQL, Prisma e CI/CD,
**so that** a equipe possa iniciar o desenvolvimento com a stack completa e pipeline de deploy funcionando.

## Acceptance Criteria

1. Projeto Next.js 15 (App Router) criado com TypeScript 5 strict mode, Tailwind CSS 4 e shadcn/ui configurados
2. Prisma ORM configurado e conectado ao PostgreSQL (Supabase) com schema inicial (modelo Tenant e User)
3. ESLint + Prettier configurados com regras para TypeScript e React
4. Estrutura de pastas DDD criada: `src/core/`, `src/modules/`, `src/integrations/`, `src/lib/`, `src/app/`
5. GitHub Actions configurado: lint + type-check + testes unitarios em cada PR
6. Deploy automatico via Vercel em push para main (preview deploys em PRs)
7. Sentry configurado para captura de erros (client e server)
8. Variáveis de ambiente configuradas (.env.example documentado)
9. pnpm como gerenciador de pacotes com lockfile commitado
10. Health check endpoint (`/api/health`) retornando status do servidor e conexao com banco

## Tasks / Subtasks

- [ ] Criar projeto Next.js 15 com `pnpm create next-app` (AC: 1, 9)
  - [ ] Selecionar: TypeScript, App Router, Tailwind CSS, ESLint, src/ directory
  - [ ] Configurar `tsconfig.json` com `strict: true`
  - [ ] Configurar path aliases: `@/` -> `src/`
- [ ] Instalar e configurar shadcn/ui (AC: 1)
  - [ ] `pnpm dlx shadcn@latest init`
  - [ ] Configurar tema com cores do semaforo (green-500, yellow-500, red-500)
  - [ ] Instalar componentes base: Button, Input, Card, Dialog, Toast
- [ ] Configurar Prisma ORM (AC: 2)
  - [ ] `pnpm add prisma @prisma/client`
  - [ ] Criar `prisma/schema.prisma` com models User e Tenant iniciais
  - [ ] Criar `src/lib/prisma.ts` (singleton client)
  - [ ] Rodar `prisma db push` para criar tabelas no Supabase
- [ ] Configurar ESLint + Prettier (AC: 3)
  - [ ] Configurar `.eslintrc.json` com regras strict para TS/React
  - [ ] Criar `.prettierrc` com configuracao padrao (singleQuote, semi, trailingComma)
  - [ ] Adicionar scripts `lint` e `format` no package.json
- [ ] Criar estrutura de pastas DDD (AC: 4)
  - [ ] `src/core/auth/`, `src/core/tenant/`, `src/core/events/`
  - [ ] `src/modules/cadastros/`, `src/modules/financeiro/`, `src/modules/vendas/`, `src/modules/fiscal/`, `src/modules/estoque/`
  - [ ] `src/integrations/pix/`, `src/integrations/whatsapp/`, `src/integrations/fiscal-api/`
  - [ ] `src/lib/`, `src/components/`, `src/hooks/`, `src/stores/`, `src/types/`
  - [ ] Criar `.gitkeep` em cada pasta vazia
- [ ] Configurar GitHub Actions CI (AC: 5)
  - [ ] Criar `.github/workflows/ci.yaml`: lint, type-check, test no PR
  - [ ] Usar pnpm/action-setup + actions/setup-node com cache
- [ ] Configurar Sentry (AC: 7)
  - [ ] `pnpm add @sentry/nextjs`
  - [ ] Configurar `sentry.client.config.ts` e `sentry.server.config.ts`
  - [ ] Adicionar Sentry ao `next.config.ts`
- [ ] Criar .env.example (AC: 8)
  - [ ] Documentar todas as env vars necessarias com comentarios
  - [ ] DATABASE_URL, NEXTAUTH_SECRET, GOOGLE_CLIENT_ID, SENTRY_DSN, etc.
- [ ] Criar health check endpoint (AC: 10)
  - [ ] `src/app/api/health/route.ts`
  - [ ] Retornar status do servidor e teste de conexao com banco via Prisma
- [ ] Instalar dependencias adicionais do projeto
  - [ ] `pnpm add zod pino date-fns`
  - [ ] `pnpm add -D vitest @testing-library/react playwright`

## Dev Notes

**Source Tree relevante:**
```
src/
├── app/
│   ├── api/health/route.ts
│   ├── layout.tsx
│   └── globals.css
├── core/
│   ├── auth/
│   ├── tenant/
│   └── events/
├── modules/ (pastas vazias com .gitkeep)
├── integrations/ (pastas vazias com .gitkeep)
├── lib/
│   └── prisma.ts
├── components/ui/ (shadcn/ui)
├── hooks/
├── stores/
└── types/
```

**Tech Stack (versoes exatas):**
- Node.js 20 LTS, pnpm 9+
- Next.js 15 (App Router), TypeScript 5 strict
- Tailwind CSS 4, shadcn/ui (latest)
- Prisma 6.x, PostgreSQL 16 (Supabase)
- Sentry (latest), Pino 9.x, Zod 3.x
- Vitest (latest), Playwright (latest)

**Prisma Schema inicial (User + Tenant):**
```prisma
model User {
  id           String       @id @default(cuid())
  email        String       @unique
  name         String
  image        String?
  provider     String       @default("google")
  passwordHash String?
  tenants      UserTenant[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  @@map("users")
}

model Tenant {
  id                  String       @id @default(cuid())
  name                String
  document            String?
  type                String       @default("INFORMAL")
  plan                String       @default("FREE")
  onboardingCompleted Boolean      @default(false)
  users               UserTenant[]
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  @@map("tenants")
}

model UserTenant {
  id       String   @id @default(cuid())
  userId   String
  tenantId String
  role     String   @default("OWNER")
  isActive Boolean  @default(false)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  @@unique([userId, tenantId])
  @@map("user_tenants")
}
```

**Coding Standards criticos para esta story:**
- TypeScript `strict: true` no tsconfig
- Nunca usar `any` - usar `unknown` com type narrowing
- Environment variables via `src/lib/env.ts` (Zod-validated)
- Structured JSON logs via Pino

### Testing

- **Localizacao:** `tests/unit/lib/` para testes de prisma client e health check
- **Framework:** Vitest
- **Minimo:** Health check endpoint retorna 200 com status JSON
- **CI:** GitHub Actions roda lint + type-check + test em cada PR

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-07 | 1.0 | Criacao inicial da story | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*A ser preenchido pelo dev agent*

### Debug Log References
*A ser preenchido pelo dev agent*

### Completion Notes List
*A ser preenchido pelo dev agent*

### File List
*A ser preenchido pelo dev agent*

## QA Results
*A ser preenchido pelo QA agent*
