# Story 1.1: Setup do Projeto e Infraestrutura Base

## Status: Ready for Review

## Story

**As a** desenvolvedor,
**I want** ter o projeto Next.js 15 configurado com TypeScript, Tailwind, shadcn/ui, PostgreSQL, Prisma e CI/CD,
**so that** a equipe possa iniciar o desenvolvimento com a stack completa e pipeline de deploy funcionando.

## Acceptance Criteria

1. Projeto Next.js 15 (App Router) criado com TypeScript 5 strict mode, Tailwind CSS 4 e shadcn/ui configurados
2. Prisma ORM configurado e conectado ao PostgreSQL (Supabase) com schema inicial (modelo Tenant e User)
3. ESLint + Prettier configurados com regras para TypeScript e React
4. Estrutura de pastas DDD criada: `src/core/`, `src/modules/`, `src/integrations/`, `src/lib/`, `src/app/`
5. GitHub Actions configurado: lint + type-check + testes unitarios em cada PR
6. Deploy automatico via Vercel em push para main (preview deploys em PRs)
7. Sentry configurado para captura de erros (client e server)
8. Variáveis de ambiente configuradas (.env.example documentado)
9. pnpm como gerenciador de pacotes com lockfile commitado
10. Health check endpoint (`/api/health`) retornando status do servidor e conexao com banco

## Tasks / Subtasks

- [x] Criar projeto Next.js 15 com `pnpm create next-app` (AC: 1, 9)
  - [x] Selecionar: TypeScript, App Router, Tailwind CSS, ESLint, src/ directory
  - [x] Configurar `tsconfig.json` com `strict: true`
  - [x] Configurar path aliases: `@/` -> `src/`
- [x] Instalar e configurar shadcn/ui (AC: 1)
  - [x] `pnpm dlx shadcn@latest init`
  - [x] Configurar tema com cores do semaforo (green-500, yellow-500, red-500)
  - [x] Instalar componentes base: Button, Input, Card, Dialog, Toast (Sonner)
- [x] Configurar Prisma ORM (AC: 2)
  - [x] `pnpm add prisma @prisma/client` (v6.19.2)
  - [x] Criar `prisma/schema.prisma` com models User, Tenant e UserTenant
  - [x] Criar `src/lib/prisma.ts` (singleton client)
  - [ ] Rodar `prisma db push` para criar tabelas no Supabase (requer DATABASE_URL)
- [x] Configurar ESLint + Prettier (AC: 3)
  - [x] Configurar `eslint.config.mjs` com regras strict para TS/React (flat config)
  - [x] Criar `.prettierrc` com configuracao padrao (singleQuote, semi, trailingComma)
  - [x] Adicionar scripts `lint`, `format`, `type-check` no package.json
- [x] Criar estrutura de pastas DDD (AC: 4)
  - [x] `src/core/auth/`, `src/core/tenant/`, `src/core/events/`
  - [x] `src/modules/cadastros/`, `src/modules/financeiro/`, `src/modules/vendas/`, `src/modules/fiscal/`, `src/modules/estoque/`
  - [x] `src/integrations/pix/`, `src/integrations/whatsapp/`, `src/integrations/fiscal-api/`
  - [x] `src/lib/`, `src/components/`, `src/hooks/`, `src/stores/`, `src/types/`
  - [x] Criar `.gitkeep` em cada pasta vazia
- [x] Configurar GitHub Actions CI (AC: 5)
  - [x] Criar `.github/workflows/ci.yaml`: lint, type-check, test no PR
  - [x] Usar pnpm/action-setup + actions/setup-node com cache
- [x] Configurar Sentry (AC: 7)
  - [x] `pnpm add @sentry/nextjs`
  - [x] Configurar `sentry.client.config.ts`, `sentry.server.config.ts` e `sentry.edge.config.ts`
  - [x] Adicionar Sentry ao `next.config.ts` via withSentryConfig
- [x] Criar .env.example (AC: 8)
  - [x] Documentar todas as env vars necessarias com comentarios
  - [x] DATABASE_URL, NEXTAUTH_SECRET, GOOGLE_CLIENT_ID, SENTRY_DSN, etc.
- [x] Criar health check endpoint (AC: 10)
  - [x] `src/app/api/health/route.ts`
  - [x] Retornar status do servidor e teste de conexao com banco via Prisma
- [x] Instalar dependencias adicionais do projeto
  - [x] `pnpm add zod@3 pino date-fns`
  - [x] `pnpm add -D vitest @testing-library/react @testing-library/jest-dom playwright jsdom`

## Dev Notes

**Source Tree relevante:**
```
src/
├── app/
│   ├── api/health/route.ts
│   ├── layout.tsx
│   └── globals.css
├── core/
│   ├── auth/
│   ├── tenant/
│   └── events/
├── modules/ (pastas vazias com .gitkeep)
├── integrations/ (pastas vazias com .gitkeep)
├── lib/
│   └── prisma.ts
├── components/ui/ (shadcn/ui)
├── hooks/
├── stores/
└── types/
```

**Tech Stack (versoes exatas):**
- Node.js 20 LTS, pnpm 9+
- Next.js 15 (App Router), TypeScript 5 strict
- Tailwind CSS 4, shadcn/ui (latest)
- Prisma 6.x, PostgreSQL 16 (Supabase)
- Sentry (latest), Pino 9.x, Zod 3.x
- Vitest (latest), Playwright (latest)

**Prisma Schema inicial (User + Tenant):**
```prisma
model User {
  id           String       @id @default(cuid())
  email        String       @unique
  name         String
  image        String?
  provider     String       @default("google")
  passwordHash String?
  tenants      UserTenant[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  @@map("users")
}

model Tenant {
  id                  String       @id @default(cuid())
  name                String
  document            String?
  type                String       @default("INFORMAL")
  plan                String       @default("FREE")
  onboardingCompleted Boolean      @default(false)
  users               UserTenant[]
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  @@map("tenants")
}

model UserTenant {
  id       String   @id @default(cuid())
  userId   String
  tenantId String
  role     String   @default("OWNER")
  isActive Boolean  @default(false)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  @@unique([userId, tenantId])
  @@map("user_tenants")
}
```

**Coding Standards criticos para esta story:**
- TypeScript `strict: true` no tsconfig
- Nunca usar `any` - usar `unknown` com type narrowing
- Environment variables via `src/lib/env.ts` (Zod-validated)
- Structured JSON logs via Pino

### Testing

- **Localizacao:** `tests/unit/lib/` para testes de prisma client e health check
- **Framework:** Vitest
- **Minimo:** Health check endpoint retorna 200 com status JSON
- **CI:** GitHub Actions roda lint + type-check + test em cada PR

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-07 | 1.0 | Criacao inicial da story | Sarah (PO) |
| 2026-02-07 | 1.1 | Implementacao completa | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
- Prisma 7 incompatible with `url` in schema.prisma - downgraded to Prisma 6.19.2
- Next.js create-next-app@latest installs v16 - used `@15` explicitly for v15.5.12
- Used `eslint.config.mjs` (flat config) instead of `.eslintrc.json` (Next.js 15 default)

### Completion Notes List
- All ACs met except AC6 (Vercel deploy) which is env-dependent
- AC2 partial: `prisma db push` not run (requires DATABASE_URL from Supabase)
- Created `src/lib/env.ts` with Zod-validated environment variables per coding standards
- Semaphore theme colors added as CSS variables in globals.css (oklch format)
- Tests: 2 tests passing (health check connected + disconnected)
- Validations: lint + type-check + test + build all passing

### File List
- `package.json` - Project config with all dependencies and scripts
- `pnpm-lock.yaml` - pnpm lockfile
- `tsconfig.json` - TypeScript strict config with @/ alias
- `next.config.ts` - Next.js config with Sentry wrapper
- `eslint.config.mjs` - ESLint flat config (next + typescript + prettier)
- `.prettierrc` - Prettier config
- `.env.example` - Documented environment variables
- `.gitignore` - Updated with coverage, sentry, vercel patterns
- `postcss.config.mjs` - PostCSS config for Tailwind
- `sentry.client.config.ts` - Sentry client initialization
- `sentry.server.config.ts` - Sentry server initialization
- `sentry.edge.config.ts` - Sentry edge initialization
- `vitest.config.ts` - Vitest config with jsdom and @/ alias
- `prisma/schema.prisma` - Prisma schema (User, Tenant, UserTenant)
- `src/app/globals.css` - Tailwind + shadcn/ui + semaphore theme
- `src/app/layout.tsx` - Root layout (scaffolded)
- `src/app/page.tsx` - Home page (scaffolded)
- `src/app/api/health/route.ts` - Health check endpoint
- `src/lib/prisma.ts` - Prisma client singleton
- `src/lib/env.ts` - Zod-validated environment variables
- `src/lib/utils.ts` - cn() utility (shadcn/ui)
- `src/components/ui/button.tsx` - shadcn/ui Button
- `src/components/ui/input.tsx` - shadcn/ui Input
- `src/components/ui/card.tsx` - shadcn/ui Card
- `src/components/ui/dialog.tsx` - shadcn/ui Dialog
- `src/components/ui/sonner.tsx` - shadcn/ui Sonner (Toast)
- `.github/workflows/ci.yaml` - GitHub Actions CI pipeline
- `tests/setup.ts` - Vitest setup with jest-dom
- `tests/unit/lib/health.test.ts` - Health check endpoint tests
- `src/core/auth/.gitkeep` - DDD structure placeholder
- `src/core/tenant/.gitkeep` - DDD structure placeholder
- `src/core/events/.gitkeep` - DDD structure placeholder
- `src/modules/cadastros/.gitkeep` - DDD structure placeholder
- `src/modules/financeiro/.gitkeep` - DDD structure placeholder
- `src/modules/vendas/.gitkeep` - DDD structure placeholder
- `src/modules/fiscal/.gitkeep` - DDD structure placeholder
- `src/modules/estoque/.gitkeep` - DDD structure placeholder
- `src/integrations/pix/.gitkeep` - DDD structure placeholder
- `src/integrations/whatsapp/.gitkeep` - DDD structure placeholder
- `src/integrations/fiscal-api/.gitkeep` - DDD structure placeholder
- `src/components/layout/.gitkeep` - DDD structure placeholder
- `src/components/forms/.gitkeep` - DDD structure placeholder
- `src/components/dashboard/.gitkeep` - DDD structure placeholder
- `src/components/shared/.gitkeep` - DDD structure placeholder
- `src/hooks/.gitkeep` - DDD structure placeholder
- `src/stores/.gitkeep` - DDD structure placeholder
- `src/types/.gitkeep` - DDD structure placeholder

## QA Results
*A ser preenchido pelo QA agent*
