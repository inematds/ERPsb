# Epic 10: Marketing e Vendas Online (v3.0)

## Visao Geral

Transformar o ERPsb de um sistema de gestao interna em uma **plataforma de vendas**. O MEI cria seu catalogo, compartilha um link, recebe pedidos online e gerencia tudo no mesmo lugar. Integra com marketplaces e usa WhatsApp como canal de marketing.

## Problema

O MEI vende de 3 formas desconectadas:
1. **Presencial** - ja gerenciado pelo ERPsb
2. **WhatsApp** - manda foto dos produtos, anota pedidos na mao, perde controle
3. **Marketplaces** - Mercado Livre, Shopee, iFood - registra tudo duas vezes

Resultado: estoque errado, vendas nao registradas, zero marketing, zero presenca online.

## Solucao

Quatro pilares:

```
1. Catalogo Online   â†’ Vitrine publica compartilhavel (link/QR)
2. Mini Loja         â†’ Carrinho + checkout com PIX (sem marketplace)
3. WhatsApp Marketing â†’ Campanhas, promocoes, reativacao de clientes
4. Marketplaces      â†’ Sync com Mercado Livre, Shopee, iFood
```

## Stories

| Story | Titulo | Descricao | Prioridade |
|-------|--------|-----------|------------|
| 10.1 | Catalogo online publico | Pagina publica com produtos, precos, fotos, link compartilhavel | Must |
| 10.2 | Mini loja com carrinho e checkout | Carrinho de compras, checkout com PIX, pedido automatico | Must |
| 10.3 | WhatsApp Marketing | Campanhas de promocao, reativacao de inativos, novidades | Should |
| 10.4 | Integracao Mercado Livre | Sync de produtos, pedidos e estoque | Should |
| 10.5 | Integracao Shopee e iFood | Mesma logica do ML para outros marketplaces | Could |

---

## Story 10.1: Catalogo Online Publico

### Descricao

Pagina publica (sem login) onde o cliente final vÃª os produtos da loja com fotos, precos e descricoes. O dono compartilha o link pelo WhatsApp, Instagram, cartao de visita.

### URL

```
https://erpsb.vercel.app/loja/{slug}
```

Exemplo: `erpsb.vercel.app/loja/maria-confeccoes`

### Funcionalidades

- Pagina publica (sem autenticacao)
- Slug personalizavel pelo dono (ex: "maria-confeccoes")
- Header com logo, nome da loja, telefone WhatsApp
- Grid de produtos com foto, nome, preco
- Filtro por categoria
- Busca por nome
- Clique no produto abre detalhe com descricao completa
- Botao "Comprar pelo WhatsApp" (abre chat com mensagem pre-formatada)
- Botao "Adicionar ao carrinho" (Story 10.2)
- QR code gerado automaticamente para impressao
- SEO basico (meta tags, Open Graph para preview no WhatsApp)
- Responsivo (mobile-first)

### Modelo de dados

```prisma
// Adicionar ao Tenant
model Tenant {
  // ... existentes ...

  // Loja online
  storeSlug      String?  @unique  // URL personalizada
  storeName      String?           // Nome da loja (pode diferir do nome da empresa)
  storeLogo      String?           // URL do logo
  storeWhatsApp  String?           // WhatsApp para contato
  storeBanner    String?           // Banner da loja
  storeActive    Boolean  @default(false) // Loja ativa/inativa
}

// Adicionar ao Produto
model Produto {
  // ... existentes ...

  // Catalogo online
  images       String[]  // URLs das fotos do produto
  showOnline   Boolean   @default(true)  // Exibir no catalogo
  category     String?   // Categoria para filtro
}
```

### Tela do dono (configuracao)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Minha Loja Online                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: ðŸŸ¢ Ativa                    â”‚
â”‚ Link: erpsb.vercel.app/loja/maria   â”‚
â”‚ [Copiar link]  [QR Code]  [Preview] â”‚
â”‚                                     â”‚
â”‚ Nome da loja:  [Maria Confeccoes]   â”‚
â”‚ WhatsApp:      [11 99988-7766]      â”‚
â”‚ Logo:          [Upload]             â”‚
â”‚ Banner:        [Upload]             â”‚
â”‚                                     â”‚
â”‚ Produtos no catalogo: 18 de 25      â”‚
â”‚ [Gerenciar produtos visiveis]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela do cliente (publica)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸª Maria Confeccoes                â”‚
â”‚ ðŸ“± (11) 99988-7766                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Buscar produtos...]               â”‚
â”‚ [Todas] [Camisetas] [Bermudas]     â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚  [foto]  â”‚ â”‚  [foto]  â”‚          â”‚
â”‚ â”‚Camiseta Pâ”‚ â”‚Bermuda GGâ”‚          â”‚
â”‚ â”‚ R$ 49,90 â”‚ â”‚ R$ 79,90 â”‚          â”‚
â”‚ â”‚[Comprar] â”‚ â”‚[Comprar] â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚  [foto]  â”‚ â”‚  [foto]  â”‚          â”‚
â”‚ â”‚ Kit Pres.â”‚ â”‚ Caneca   â”‚          â”‚
â”‚ â”‚R$ 129,90 â”‚ â”‚ R$ 35,00 â”‚          â”‚
â”‚ â”‚[Comprar] â”‚ â”‚[Comprar] â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Story 10.2: Mini Loja com Carrinho e Checkout

### Descricao

O cliente adiciona produtos ao carrinho e finaliza a compra com pagamento PIX. O pedido cai automaticamente no ERPsb como uma venda.

### Fluxo

```
Cliente acessa catalogo â†’ Adiciona itens ao carrinho â†’
Informa nome + telefone â†’ Gera PIX â†’ Paga â†’
Webhook confirma â†’ Venda criada â†’ Dono notificado (WhatsApp)
```

### Funcionalidades

- Carrinho persistente (localStorage)
- Alterar quantidade no carrinho (+/-)
- Checkout simplificado: nome, telefone, observacao (sem cadastro)
- Pagamento via PIX (QR code Mercado Pago, ja integrado)
- Pagina de "Pedido realizado" com status em tempo real
- Ao confirmar pagamento:
  - Cria Venda automaticamente no ERPsb
  - Baixa estoque
  - Cria ContaReceber (ja paga)
  - Notifica dono via WhatsApp ("Novo pedido de R$ X de Joao!")
- Se PIX nao for pago em 30 min, pedido expira

### Modelo de dados

```prisma
model Pedido {
  id           String   @id @default(cuid())
  tenantId     String
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
  customerName String
  customerPhone String
  items        Json     // Mesmo formato de Venda.items
  subtotal     Int
  total        Int
  notes        String?
  status       String   @default("AGUARDANDO_PAGAMENTO")
  // AGUARDANDO_PAGAMENTO, PAGO, EXPIRADO, CANCELADO

  pixChargeId  String?  // Vinculo com cobranca PIX
  vendaId      String?  // Vinculo com Venda (criada apos pagamento)

  expiresAt    DateTime
  paidAt       DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([tenantId, status])
  @@map("pedidos")
}
```

---

## Story 10.3: WhatsApp Marketing

### Descricao

Ferramentas para o dono usar o WhatsApp como canal de marketing: enviar promocoes, novidades e reativar clientes inativos.

### Funcionalidades

- **Campanhas de promocao:**
  - Criar campanha: nome, mensagem, produtos em destaque, desconto
  - Selecionar publico: todos os clientes, segmento (compraram produto X, inativos ha Y dias)
  - Agendar envio ou enviar agora
  - Incluir link do catalogo online na mensagem

- **Reativacao de inativos:**
  - Sistema identifica clientes que nao compram ha X dias (configuravel)
  - Sugere mensagem: "Oi {nome}! Faz tempo que nao te vemos. Temos novidades..."
  - Pode incluir cupom de desconto

- **Novidades e lancamentos:**
  - Ao cadastrar produto novo, opcao de notificar clientes
  - Mensagem com foto do produto + preco + link do catalogo

- **Metricas:**
  - Mensagens enviadas, entregues, lidas
  - Cliques no link do catalogo
  - Vendas atribuidas a campanha (rastreamento por UTM ou cupom)

### Templates WhatsApp

```
// Promocao
"ðŸ”¥ {nome_loja}: {titulo_campanha}!
{descricao}
Ate {desconto}% de desconto!
Veja: {link_catalogo}
Valido ate {data_fim}"

// Reativacao
"Oi {nome_cliente}! Sentimos sua falta na {nome_loja}.
Temos novidades especiais pra voce!
Confira: {link_catalogo}
Use o cupom VOLTEI e ganhe {desconto}% na proxima compra"

// Lancamento
"Novidade na {nome_loja}! ðŸŽ‰
{nome_produto} por apenas R$ {preco}
{link_produto}
Corre que e por tempo limitado!"
```

### Modelo de dados

```prisma
model Campanha {
  id           String   @id @default(cuid())
  tenantId     String
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
  name         String
  type         String   // PROMOCAO, REATIVACAO, LANCAMENTO
  message      String   // Template da mensagem
  discount     Int?     // Desconto em centavos ou percentual
  couponCode   String?  // Codigo do cupom
  targetFilter Json?    // Filtro de publico-alvo
  status       String   @default("RASCUNHO")
  // RASCUNHO, AGENDADA, ENVIANDO, CONCLUIDA, CANCELADA

  scheduledAt  DateTime?
  sentCount    Int      @default(0)
  deliveredCount Int    @default(0)
  readCount    Int      @default(0)
  clickCount   Int      @default(0)
  salesCount   Int      @default(0)
  salesTotal   Int      @default(0) // Em centavos

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([tenantId, status])
  @@map("campanhas")
}
```

---

## Story 10.4: Integracao Mercado Livre

### Descricao

Conectar a conta do Mercado Livre para sincronizar produtos, receber pedidos automaticamente e manter estoque atualizado em ambos os canais.

### Funcionalidades

- **Autenticacao OAuth** com Mercado Livre
- **Sync de produtos:**
  - Publicar produtos do ERPsb no ML
  - Importar produtos existentes do ML
  - Sincronizar preco e estoque (bidirecional)
- **Pedidos:**
  - Webhook recebe notificacao de venda no ML
  - Cria Venda + baixa estoque + ContaReceber automaticamente
  - Status do pedido sincronizado (separacao, envio, entregue)
- **Financeiro:**
  - Registra automaticamente taxa/comissao do ML como despesa
  - Calcula margem real considerando taxa ML (11-16%)
- **Dashboard:**
  - Vendas ML vs loja fisica no mesmo grafico
  - Metricas ML: reputacao, perguntas, reclamacoes

### Fluxo

```
Produto no ERPsb â†’ Publicar no ML â†’
Venda no ML â†’ Webhook â†’ Cria Venda + baixa estoque â†’
Comissao ML â†’ Registra despesa automatica â†’
Dashboard unificado
```

---

## Story 10.5: Integracao Shopee e iFood

### Descricao

Mesma logica da Story 10.4 para Shopee (e-commerce) e iFood (alimentacao). Cada marketplace tem seu adapter mas o fluxo e o mesmo.

### Adapters

| Marketplace | API | Tipo de negocio |
|-------------|-----|-----------------|
| Mercado Livre | REST (OAuth 2.0) | Comercio geral |
| Shopee | REST (OAuth 2.0) | Comercio geral |
| iFood | REST (OAuth 2.0) | Alimentacao |

---

## Limites por plano

| Plano | Catalogo | Carrinho | Campanhas/mes | Marketplaces |
|-------|----------|----------|--------------|-------------|
| Gratis | 10 produtos | Nao | 0 | 0 |
| Starter | 50 produtos | Sim | 2 | 0 |
| Growth | 200 produtos | Sim | 10 | 1 |
| Pro | Ilimitado | Sim | Ilimitado | Ilimitado |

## Metricas de sucesso

- **Catalogo:** 30%+ dos usuarios ativam loja online no primeiro mes
- **Vendas online:** 15%+ das vendas vem do catalogo/carrinho em 6 meses
- **WhatsApp marketing:** Taxa de abertura > 70%, conversao > 5%
- **Marketplaces:** Usuarios com marketplace integrado tem ticket medio 40% maior
- **Reativacao:** 20%+ dos clientes inativos voltam a comprar apos campanha

## Riscos

| Risco | Mitigacao |
|-------|----------|
| SEO fraco (dominio compartilhado) | Subdominio customizado no plano Pro |
| Carrinho abandonado | Lembrete WhatsApp apos 1h |
| Fraude no PIX (compra e nao paga) | Pedido so processado apos confirmacao do pagamento |
| API do ML muda frequentemente | Abstraction layer, testes de integracao |
| Custo de manutencao de integracao | Comecar com ML (maior demanda), expandir gradualmente |
| Spam no WhatsApp (bloqueio) | Respeitar limites do WhatsApp Business, opt-in obrigatorio |
